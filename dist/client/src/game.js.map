{"version":3,"file":"game.js","sourceRoot":"","sources":["../../../../client/src/game.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,8CAAwB;AACxB,mCAAkC;AAClC,wEAAkD;AAWlD;IAYE,cAAY,QAAkB,EAAE,WAAkB,EAAE,IAAU,EAAE,KAAa,EAAE,WAAmB,EAAE,EAAW;QAC7G,IAAI,CAAC,MAAM,GAAG,IAAI,eAAM,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,CAAC,QAAQ,GAAG,WAAW,IAAI,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;QAC3D,IAAI,CAAC,GAAG,GAAG,IAAI,aAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC/C,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAC7C,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;IACf,CAAC;IAED,2BAAY,GAAZ;QACE,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,IAAA,0BAAgB,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,IAAI,IAAI,CAAC,WAAW,IAAI,OAAO,IAAI,IAAI,CAAC,QAAQ,eAAgB,EAAE;YAChE,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;SAC3C;QACD,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;IAChC,CAAC;IAEK,2BAAY,GAAlB,UAAmB,KAAU;;;;;;wBACvB,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;wBACxB,IAAI,IAAI,CAAC,QAAQ,kBAAmB,IAAI,MAAM,CAAC,IAAI,KAAK,IAAI,CAAC,WAAW,EAAE;4BACxE,sBAAO;yBACR;6BAEG,CAAC,CAAC,IAAI,CAAC,QAAQ,eAAgB,IAAI,MAAM,CAAC,IAAI,KAAK,IAAI,CAAC,WAAW,CAAC,EAApE,wBAAoE;wBACtE,IAAI,CAAC,CAAC,KAAK,CAAC,MAAM,YAAY,OAAO,CAAC,EAAE;4BACtC,sBAAO;yBACR;wBACG,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;6BACrD,MAAM,EAAN,wBAAM;wBACR,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;4BAC9B,sBAAO;yBACR;wBACG,QAAQ,GAAG,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;wBACzC,IAAI,CAAC,QAAQ,EAAE;4BACb,sBAAM;yBACP;wBACG,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;wBACnD,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,MAAM,CAAC,UAAU,CAAC,CAAC;wBAC5D,IAAI,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;4BACnD,sBAAO;yBACR;6BACG,CAAA,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,IAAI,IAAI,CAAC,QAAQ,eAAgB,CAAA,EAA9D,wBAA8D;wBAChE,qBAAM,KAAK,CAAC,IAAI,CAAC,EAAA;;wBAAjB,SAAiB,CAAC;wBAClB,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;wBAC1C,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;;;;wBAI1F,MAAM,CAAC,aAAa,EAAE,CAAC;;;;;;KAK5B;IACH,WAAC;AAAD,CAAC,AAtED,IAsEC;;AAGD,SAAS,KAAK,CAAC,EAAU;IACvB,OAAO,IAAI,OAAO,CAAC,UAAA,OAAO,IAAI,OAAA,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,EAAvB,CAAuB,CAAC,CAAC;AACzD,CAAC","sourcesContent":["import Bot from \"./bot\";\r\nimport { Engine } from \"./engine\";\r\nimport createChessboard from \"./createChessboard\";\r\nimport { SIDE } from \"./config\";\r\n\r\nexport const enum GAMEMODE {\r\n  LOCAL,\r\n  BOT,\r\n  ONLINE\r\n}\r\n\r\ntype Color = \"black\" | \"white\";\r\n\r\nexport default class Game {\r\n\r\n  engine: Engine;\r\n  bot: Bot;\r\n  gameMode: GAMEMODE;\r\n  playerColor: Color;\r\n  botColor: Color;\r\n  side: SIDE;\r\n  label: string;\r\n  gameCounter: number\r\n  id?: string;\r\n\r\n  constructor(gameMode: GAMEMODE, playerColor: Color, side: SIDE, label: string, gameCounter: number, id?: string) {\r\n    this.engine = new Engine(side);\r\n    this.botColor = playerColor == \"white\" ? \"black\" : \"white\";\r\n    this.bot = new Bot(this.engine, this.botColor);\r\n    this.gameMode = gameMode;\r\n    this.playerColor = playerColor;\r\n    this.side = side;\r\n    this.label = label;\r\n    this.engine.chessboard = this.startNewGame();\r\n    this.gameCounter = gameCounter;\r\n    this.id = id;\r\n  }\r\n\r\n  startNewGame() {\r\n    this.engine.chessboard = createChessboard(this.side);\r\n    if (this.playerColor == \"black\" && this.gameMode == GAMEMODE.BOT) {\r\n      this.bot.makeMove(this.engine.chessboard);\r\n    }\r\n    return this.engine.chessboard;\r\n  }\r\n\r\n  async clickHandler(event: any) {\r\n    let engine = this.engine\r\n    if (this.gameMode == GAMEMODE.ONLINE && engine.turn !== this.playerColor) {\r\n      return;\r\n    }\r\n\r\n    if (!(this.gameMode == GAMEMODE.BOT && engine.turn !== this.playerColor)) {\r\n      if (!(event.target instanceof Element)) {\r\n        return;\r\n      }\r\n      let square = event.target.closest(\".chessboard__square\");\r\n      if (square) {\r\n        if (!square.getAttribute(\"id\")) {\r\n          return;\r\n        }\r\n        let squareId = square.getAttribute(\"id\");\r\n        if (!squareId) {\r\n          return\r\n        }\r\n        let board = JSON.stringify(this.engine.chessboard);\r\n        engine.performAction(parseInt(squareId), engine.chessboard);\r\n        if (board == JSON.stringify(this.engine.chessboard)) {\r\n          return;\r\n        }\r\n        if (engine.turn == this.bot.color && this.gameMode == GAMEMODE.BOT) {\r\n          await sleep(2000);\r\n          this.bot.makeMove(this.engine.chessboard);\r\n          this.engine.setWinner(this.engine.chessboard, this.engine.turn, this.engine.playerSide);\r\n        }\r\n\r\n      } else {\r\n        engine.unselectPiece();\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n}\r\n\r\n\r\nfunction sleep(ms: number) {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}"]}